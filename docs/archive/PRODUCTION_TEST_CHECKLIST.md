# XLO System 本番環境 完全動作検証チェックリスト

**本番URL**: https://xlo-system-2suwnlfe1-sakamoto334422-gmailcoms-projects.vercel.app

## 検証日時
- 日付: 2025-11-21
- 検証者:

---

## 🔧 コードレベル検証結果

### ✅ デプロイ状態
- [x] Vercel本番環境デプロイ完了
- [x] Supabase Edge Functions 全20関数デプロイ完了
- [x] 環境変数設定完了 (APP_URL追加済み)
- [x] データベース接続確認完了

### ✅ 実装済み機能
- [x] CSV一括入力機能 (全アカウントタイプ対応)
- [x] OAuth 2.0 認証フロー (PKCE対応)
- [x] トークン自動リフレッシュ
- [x] 予約投稿機能 (タイムゾーン対応)
- [x] 一括投稿機能
- [x] 3種類のループシステム
- [x] エンゲージメント自動化
- [x] ターゲット機能
- [x] プロキシ管理

---

## 📋 機能別テストチェックリスト

### 1. Twitter Apps 管理

#### 1.1 アプリ登録
- [ ] 「新規追加」ボタンをクリック
- [ ] アプリ名、Client ID、Client Secret、Callback URLを入力
- [ ] 保存成功を確認
- [ ] アプリ一覧に表示されることを確認

**テストデータ例**:
```
App Name: Test App
Client ID: [Twitter Developer PortalのClient ID]
Client Secret: [Twitter Developer PortalのClient Secret]
Callback URL: https://swyiwqzlmozlqircyyzr.supabase.co/functions/v1/twitter-oauth-callback-v2
```

#### 1.2 アプリ編集・削除
- [ ] 編集ボタンで既存アプリを編集
- [ ] 削除ボタンでアプリを削除
- [ ] アクティブ/非アクティブ切り替え

---

### 2. メインアカウント管理

#### 2.1 手動追加
- [ ] 「新規追加」でアカウント情報を入力
- [ ] ハンドル名、パスワード、メールを入力
- [ ] 保存成功を確認

#### 2.2 CSV一括登録
- [ ] 「CSV一括登録」ボタンをクリック
- [ ] サンプルCSVフォーマット:
```csv
screen,password,mail,mailpw,reg_number,auth,二段階認証コード取得URL,バックアップコード
test_user1,pass123,test1@example.com,mailpass123,123456,auth123,https://...,code1,code2
test_user2,pass456,test2@example.com,mailpass456,789012,auth456,https://...,code3,code4
```
- [ ] CSVファイルをアップロード
- [ ] プレビューが正しく表示されることを確認
- [ ] 「インポート実行」をクリック
- [ ] 成功/失敗件数を確認

#### 2.3 X連携（OAuth認証）
**重要**: この機能が最も重要です

- [ ] Twitter Appが少なくとも1つ登録されていることを確認
- [ ] メインアカウント一覧で「X連携」ボタンをクリック
- [ ] Twitterの認証ページにリダイレクトされることを確認
- [ ] Twitterでアプリを認証
- [ ] リダイレクト後、「連携済み」と表示されることを確認
- [ ] トークンが `account_tokens` テーブルに保存されることを確認

**トラブルシューティング**:
- 認証失敗時: Twitter Appの設定を再確認
- リダイレクトエラー: Callback URLが正しいか確認

#### 2.4 CSV一括連携
- [ ] 複数アカウントを選択（チェックボックス）
- [ ] 「選択したアカウントをX連携」ボタンをクリック
- [ ] 連携キューが作成されることを確認
- [ ] 各アカウントが順番に認証されることを確認
- [ ] 全アカウントの連携完了を確認

---

### 3. フォロー/スパムアカウント管理

#### 3.1 CSV一括登録
- [ ] フォローアカウント管理画面で「CSV一括登録」
- [ ] CSVフォーマット:
```csv
screen,password,mail,mailpw,reg_number,auth
follow_user1,pass123,follow1@example.com,mailpass123,123456,auth123
```
- [ ] インポート成功を確認
- [ ] スパムアカウントでも同様にテスト

#### 3.2 アカウント操作
- [ ] アカウントの編集
- [ ] アカウントの削除
- [ ] アクティブ/非アクティブ切り替え

---

### 4. テンプレート管理

#### 4.1 投稿テンプレート作成
- [ ] 「新規テンプレート」をクリック
- [ ] テンプレート名、コンテンツを入力
- [ ] テンプレートタイプを選択（post/reply/cta）
- [ ] 保存成功を確認

#### 4.2 重み付けアイテム
- [ ] テンプレート編集画面で「アイテム追加」
- [ ] 複数のアイテムを追加（それぞれ異なる重み）
```
アイテム1: "こんにちは！" (重み: 10)
アイテム2: "Hello!" (重み: 5)
アイテム3: "おはよう！" (重み: 3)
```
- [ ] 保存して、ランダム選択でアイテムが使用されることを確認

#### 4.3 テンプレート編集・削除
- [ ] 既存テンプレートの編集
- [ ] テンプレートの削除
- [ ] 使用統計の表示

---

### 5. 投稿管理

#### 5.1 即時投稿
- [ ] 「新規投稿」をクリック
- [ ] コンテンツを入力
- [ ] 実行アカウントを選択（X連携済みアカウント）
- [ ] scheduled_atを空欄のまま保存
- [ ] ステータスが「draft」になることを確認
- [ ] 「今すぐ投稿」ボタンをクリック
- [ ] **実際にXに投稿されることを確認** ⭐

**期待される動作**:
- `execute-single-post` 関数が呼び出される
- `twitter-api-proxy` 経由でX APIに投稿
- 投稿成功後、ステータスが「posted」に変更
- tweet_idが保存される

#### 5.2 予約投稿
- [ ] 新規投稿作成
- [ ] scheduled_atに未来の日時を設定（例: 10分後）
- [ ] 保存後、ステータスが「scheduled」になることを確認
- [ ] 10分後、`execute-scheduled-posts` 関数が自動実行
- [ ] **実際にXに投稿されることを確認** ⭐

**自動実行の確認方法**:
```bash
# Supabase関数ログを確認
supabase functions logs execute-scheduled-posts --project-ref swyiwqzlmozlqircyyzr
```

#### 5.3 一括投稿
- [ ] 複数の投稿を選択（チェックボックス）
- [ ] 「一括投稿実行」ボタンをクリック
- [ ] プレビューモードで確認
- [ ] 実行して全投稿が成功することを確認
- [ ] **実際にXに複数投稿されることを確認** ⭐

---

### 6. ループ機能 ⭐重要

#### 6.1 投稿ループ
**設定**:
- [ ] ループ管理画面で「新規ループ」
- [ ] ループタイプ: 「投稿ループ」を選択
- [ ] 複数のテンプレートを選択（チェックボックス）
- [ ] 選択モード: 「ランダム」または「順次」
- [ ] 実行間隔: 5分（テスト用）
- [ ] 実行アカウント: 2-3アカウント選択
- [ ] 最小/最大アカウント数: 1/2
- [ ] 保存してループを作成

**実行テスト**:
- [ ] 「今すぐ実行」ボタンをクリック
- [ ] **実際にXに投稿されることを確認** ⭐
- [ ] 選択したテンプレートからランダム/順次に選択されることを確認
- [ ] 指定したアカウント数で投稿されることを確認

**自動実行テスト**:
- [ ] ループをアクティブ化
- [ ] 5分後に自動実行されることを確認
- [ ] ログを確認: `execute-loop` 関数

#### 6.2 リプライループ
**設定**:
- [ ] ループタイプ: 「リプライループ」を選択
- [ ] リプライテンプレートを選択
- [ ] ターゲット設定:
  - タイプ: 「検索」「アカウントURL」「ツイートURL」から選択
  - 値: 検索クエリまたはURL
- [ ] 実行回数: 5回/実行
- [ ] 実行間隔: 10分

**実行テスト**:
- [ ] 「今すぐ実行」をクリック
- [ ] **実際にXでリプライが投稿されることを確認** ⭐
- [ ] ターゲットツイートに正しくリプライされることを確認

#### 6.3 CTAループ
**設定**:
- [ ] ループタイプ: 「CTAループ」を選択
- [ ] CTAテンプレートを選択
- [ ] 監視アカウントハンドルを入力（例: @elonmusk）
- [ ] 実行アカウント: 1つのみ選択
- [ ] 実行間隔: なし（イベント駆動）

**実行テスト**:
- [ ] CTAループをアクティブ化
- [ ] `execute-cta-loop` 関数が定期的に監視を開始
- [ ] 監視対象アカウントが新しいツイートを投稿したら自動リプライ
- [ ] **実際にXでCTAリプライが投稿されることを確認** ⭐

**ログ確認**:
```bash
# CTA loop execution logs
supabase functions logs execute-cta-loop --project-ref swyiwqzlmozlqircyyzr
```

---

### 7. エンゲージメント機能

#### 7.1 ルール作成
- [ ] 「新規ルール」をクリック
- [ ] ルール名を入力
- [ ] 検索タイプ: キーワード、URL、ユーザー、ハッシュタグ
- [ ] 検索クエリを入力
- [ ] アクションタイプを選択（いいね、リツイート、リプライ、フォロー、引用）
- [ ] フィルター条件を設定:
  - 最小フォロワー数
  - アカウント年齢
  - 除外キーワード
- [ ] 実行設定:
  - 最大アクション数/実行
  - 実行間隔
  - 日次制限
- [ ] 保存

#### 7.2 ルール実行
- [ ] ルールをアクティブ化
- [ ] 「今すぐ実行」をクリック
- [ ] **実際にXでアクションが実行されることを確認** ⭐
- [ ] 実行履歴を確認
- [ ] 成功/失敗カウントを確認

**ログ確認**:
```bash
supabase functions logs execute-auto-engagement --project-ref swyiwqzlmozlqircyyzr
```

---

### 8. ターゲット機能

#### 8.1 ターゲット設定
- [ ] ターゲット機能画面を開く
- [ ] ターゲットURLを入力（ツイートURL）
- [ ] アクションを選択:
  - [ ] いいね
  - [ ] リツイート
  - [ ] リプライ
  - [ ] フォロー
- [ ] アカウントタイプを選択（follow/spam）
- [ ] 実行設定:
  - 最大アクション数/時間
  - 最大合計アクション数
- [ ] 保存

#### 8.2 ターゲット実行
- [ ] 「実行開始」をクリック
- [ ] **実際にXでアクションが実行されることを確認** ⭐
- [ ] 進捗状況を確認
- [ ] 完了後、結果を確認

---

### 9. プロキシ管理

#### 9.1 プロキシ登録
- [ ] 「新規プロキシ」をクリック
- [ ] プロキシ情報を入力:
```
Host: proxy.example.com
Port: 8080
Username: user
Password: pass
Type: HTTP/HTTPS/SOCKS5
```
- [ ] 保存

#### 9.2 アカウント紐付け
- [ ] プロキシ一覧でアカウント紐付けを確認
- [ ] 特定のアカウントにプロキシを割り当て
- [ ] 接続テストを実行

---

### 10. エラーハンドリング

#### 10.1 トークンリフレッシュ
- [ ] アカウントトークンの有効期限が近い場合、自動リフレッシュされることを確認
- [ ] `twitter-api-proxy` ログで「Token refreshing」を確認
- [ ] リフレッシュ後も投稿が継続できることを確認

#### 10.2 エラー処理
- [ ] 無効なトークンで投稿を試みる
- [ ] 適切なエラーメッセージが表示されることを確認
- [ ] レート制限エラーのハンドリングを確認
- [ ] トースト通知が正しく表示されることを確認

---

## 🔍 データベース確認

### 主要テーブルの確認
```sql
-- Twitter Apps
SELECT id, app_name, is_active FROM twitter_apps;

-- Main Accounts
SELECT id, handle, is_active FROM main_accounts;

-- Account Tokens
SELECT account_id, token_type, expires_at, is_active FROM account_tokens;

-- Posts
SELECT id, content, status, posted_at, tweet_id FROM posts ORDER BY created_at DESC LIMIT 10;

-- Loops
SELECT id, loop_name, loop_type, is_active FROM loops;

-- Engagement Rules
SELECT id, name, action_types, is_active FROM engagement_rules;
```

---

## ⚠️ 既知の問題と注意事項

### 1. OAuth認証
- **問題**: Callback URLが正しく設定されていないと認証に失敗
- **解決**: Twitter Developer Portalで `https://swyiwqzlmozlqircyyzr.supabase.co/functions/v1/twitter-oauth-callback-v2` を設定

### 2. トークンリフレッシュ
- **問題**: 5分以内に期限切れのトークンは自動リフレッシュされる
- **確認方法**: `account_tokens` テーブルの `expires_at` を確認

### 3. タイムゾーン
- **問題**: 予約投稿のタイムゾーン処理
- **解決済み**: ローカル時間 ⇔ UTC変換を正しく実装済み

### 4. レート制限
- **問題**: X APIのレート制限（15分/300リクエスト）
- **対策**: `rate_limits` テーブルでトラッキング、警告表示

---

## ✅ 最終確認

### 本番環境で必ず確認すること
- [ ] **1. OAuth認証が完全に動作** ⭐⭐⭐
- [ ] **2. 投稿がXに実際に反映される** ⭐⭐⭐
- [ ] **3. ループが自動実行される** ⭐⭐⭐
- [ ] **4. CSV一括登録が動作** ⭐⭐
- [ ] **5. 予約投稿が指定時刻に実行** ⭐⭐
- [ ] 6. エンゲージメント自動化が動作
- [ ] 7. エラー処理が適切
- [ ] 8. トークンリフレッシュが自動実行

---

## 📊 テスト結果サマリー

| 機能カテゴリ | テスト項目数 | 成功 | 失敗 | 備考 |
|------------|------------|------|------|------|
| Twitter Apps | 6 | | | |
| アカウント管理 | 10 | | | |
| テンプレート | 6 | | | |
| 投稿管理 | 8 | | | |
| ループ | 12 | | | |
| エンゲージメント | 6 | | | |
| ターゲット | 6 | | | |
| プロキシ | 4 | | | |
| エラー処理 | 4 | | | |
| **合計** | **62** | | | |

---

## 📝 テスト実施記録

### テスト実施者
- 名前:
- 日時: 2025-11-21

### 発見された問題

1. **問題**:
   - **再現手順**:
   - **期待される動作**:
   - **実際の動作**:
   - **優先度**: 高/中/低

2. **問題**:
   - **再現手順**:
   - **期待される動作**:
   - **実際の動作**:
   - **優先度**: 高/中/低

---

## 🎯 次のステップ

### 優先度: 高
1. OAuth認証の完全テスト
2. 実際のX投稿テスト（全機能）
3. CSV一括連携テスト

### 優先度: 中
1. エンゲージメント自動化の長期実行テスト
2. レート制限の動作確認
3. プロキシ機能のテスト

### 優先度: 低
1. UIの微調整
2. パフォーマンス最適化
3. ログの詳細化

---

## 📚 参考資料

- **本番URL**: https://xlo-system-2suwnlfe1-sakamoto334422-gmailcoms-projects.vercel.app
- **Supabase Dashboard**: https://supabase.com/dashboard/project/swyiwqzlmozlqircyyzr
- **Vercel Dashboard**: https://vercel.com/dashboard
- **Twitter Developer Portal**: https://developer.twitter.com/

---

**検証完了日**: ___________
**承認者**: ___________
**署名**: ___________
